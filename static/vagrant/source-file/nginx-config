server {

	## There is a VirtualBox bug related to sendfile which can result in corrupted or non-updating files. You should deactivate sendfile in any web servers you may be running.
	sendfile off;

	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!

	#include snippets/snakeoil.conf;

	root /var/www/cake/webroot;

	# Add index.php to the list if you are using PHP
	index index.php;

	server_name science.local;

    ssl_certificate     /etc/nginx/certs/vagrantbox.crt;
    ssl_certificate_key /etc/nginx/certs/vagrantbox.key;


    # include include/ssl.conf;
    ssl_session_timeout			20m;
    ssl_session_cache			shared:SSL:20m;
    ssl_protocols			TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers		on;
    ssl_ciphers				ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK;


    # include include/security.conf;
    add_header		X-Frame-Options		"SAMEORIGIN";
    add_header		X-Content-Type-Options	"nosniff";

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        try_files $uri =404;

        # include include/php-fpm.conf;
        fastcgi_pass    unix:/run/php/php7.2-fpm.sock;
        include fastcgi_params;
        fastcgi_split_path_info			^(.+?\.php)(/.*)?$;
        fastcgi_param	SCRIPT_FILENAME		$document_root$fastcgi_script_name;
        fastcgi_param	PATH_TRANSLATED		$document_root$fastcgi_script_name;
        set		$path_info		$fastcgi_path_info;
        fastcgi_param	PATH_INFO		$path_info;
        fastcgi_param	SERVER_ADMIN		email@example.com;
        fastcgi_param	SERVER_SIGNATURE	nginx/$nginx_version;
        fastcgi_index	index.php;
        fastcgi_read_timeout 300;
        fastcgi_send_timeout 300;
    }
}